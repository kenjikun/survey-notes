version: 2
executors:
  default:
    docker:
      - image: circleci/node:8.11.4

jobs:
  deploy:
    executor:
      name: default
    steps:
      - checkout
      - run:
          name: install dependencies
          command: |
            npm install gitbook-cli
            git config --global user.name kenjikun
            git config --global user.email $GITHUB_TOKEN
            ./node_modules/gitbook-cli/bin/gitbook.js install
            ./node_modules/gitbook-cli/bin/gitbook.js build
            cd _book/
            git init
            git commit --allow-empty -m '[ci skip] update docs'
            git checkout -b gh-pages
            git add .
            git commit -am '[ci skip] update docs'
            git push --force git@github.com:USER/REPO.git gh-pages

workflows:
  setup_and_deploy:
    jobs:
      - deploy:
          name: update docs
          filters:
            branches:
              only: master
